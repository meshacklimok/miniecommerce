{% extends 'base.html' %}
{% load static %}
{% block title %}{{ product.name }}{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row">

        <!-- Left Column: Product Images -->
        <div class="col-md-6">

            {% if product.main_image %}
            <img id="mainProductImage" src="{{ product.main_image.url }}" class="img-fluid rounded mb-3" alt="{{ product.name }}">
            {% elif product.image %}
            <img id="mainProductImage" src="{{ product.image.url }}" class="img-fluid rounded mb-3" alt="{{ product.name }}">
            {% else %}
            <img id="mainProductImage" src="{% static 'images/no-image.png' %}" class="img-fluid rounded mb-3" alt="No Image">
            {% endif %}

            {% if additional_images %}
            <div class="d-flex flex-wrap gap-2">
                {% for img in additional_images %}
                <img src="{{ img.image.url }}" class="img-thumbnail thumbnail-img"
                     style="width:80px; height:80px; object-fit:cover; cursor:pointer;" alt="Additional Image">
                {% endfor %}
            </div>
            {% endif %}

        </div>

        <!-- Right Column: Product Details -->
        <div class="col-md-6">
            <h2 class="fw-bold">{{ product.name }}</h2>

            {% if product.category %}
            <p class="text-muted">{{ product.category.name }}</p>
            {% endif %}

            <h4 class="text-success fw-bold">Ksh {{ product.price }}</h4>
            <p>{{ product.description }}</p>

            {% if product.is_in_stock %}
            <span class="badge bg-success mb-3">In Stock</span>
            {% else %}
            <span class="badge bg-danger mb-3">Out of Stock</span>
            {% endif %}

            <a href="{% url 'store:add_to_cart' product.id %}" class="btn btn-primary fw-bold mb-4">
                Add to Cart
            </a>

            <!-- SUPERUSER ONLY EDIT BUTTON -->
            {% if request.user.is_superuser %}
            <div class="mt-3">
                <a href="{% url 'store:update_product' product.id %}" 
                   class="btn btn-warning btn-sm d-flex align-items-center">
                    <img src="{% static 'icons/edit.png' %}" style="width:18px; margin-right:6px;">
                    Edit Product
                </a>
            </div>
            {% endif %}
            <!-- DELETE BUTTON REMOVED FOR CUSTOMERS -->

        </div>
    </div>
</div>

<!-- JS: Switch main image when thumbnail clicked -->
<script>
const mainImage = document.getElementById('mainProductImage');
const thumbnails = document.querySelectorAll('.thumbnail-img');

thumbnails.forEach(img => {
    img.addEventListener('click', () => {
        mainImage.src = img.src;
    });
});
</script>
{% endblock %}

